name: Policy Check
on:
  workflow_dispatch:
    inputs:
      runcheck:
        description: 'Run Policy check'
        required: true
        default: 'false'
        type: choice
        options:
          - 'true'
          - 'false'
  pull_request:
    types: [opened, reopened]
  push:
    paths:
      - 'apps/webinar-app/**'

jobs:
  checkout:
    runs-on: ubuntu-latest
    steps:
    # always use policies from main
    - name: checkout-policies
      uses: actions/checkout@v3
      with:
        ref: main
        path: policy-library

    # working branch
    - name: checkout
      uses: actions/checkout@v3
      with:
        path: working-branch

    - name: debug
      run: ls -l; echo ${{ inputs.runcheck }}

  policycheck:
    needs: [checkout]
    if: inputs.runcheck == 'true'
    runs-on: ubuntu-latest
    steps:
    - name: policy-agent-helm
      uses: weaveworks/weave-action@v1
      with:
        path: working-branch/apps/webinar-app
        policies-path: policy-library/policy
